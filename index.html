<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">



  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">










<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.5.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="ceshihao&#39;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Ceshihao">
<meta property="og:url" content="http://ceshihao.github.io/index.html">
<meta property="og:site_name" content="Ceshihao">
<meta property="og:description" content="ceshihao&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zheng Dayu">
<meta name="twitter:card" content="summary">






  <link rel="canonical" href="http://ceshihao.github.io/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Ceshihao</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ceshihao</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Ceshihao's Blog</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    
  
  
  
    
      
    
    <a href="https://github.com/ceshihao" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#222; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    
      </a>
    



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ceshihao.github.io/2021/11/23/jvm-cgroup-limit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Dayu">
      <meta itemprop="description" content="ceshihao's blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ceshihao">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/11/23/jvm-cgroup-limit/" itemprop="url">
                  Docker容器中JVM资源限制
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-11-23 15:33:42" itemprop="dateCreated datePublished" datetime="2021-11-23T15:33:42Z">2021-11-23</time>
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/11/23/jvm-cgroup-limit/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2021/11/23/jvm-cgroup-limit/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h2><p>众所周知，Docker 容器时利用 <a href="https://docs.docker.com/config/containers/resource_constraints/" target="_blank" rel="noopener">CGroup</a> 对进程使用的资源进行限制的。<br>而旧版本的JVM（低于 8u131）与top/free等系统命令有类似的问题，并不会自动识别CGroup的资源限制。这将导致JVM读取和分配的是整台机器的资源，一旦进程使用的资源超过容器的限制就会被Docker杀死，造成Java应用OOM。<br>很明显，Java社区很快也意识到了<a href="https://blogs.oracle.com/java/post/java-se-support-for-docker-cpu-and-memory-limits" target="_blank" rel="noopener">这个问题</a>，在后续的版本里进行了支持。</p>
<h2 id="8u131版本"><a href="#8u131版本" class="headerlink" title="8u131版本"></a>8u131版本</h2><p>从 <a href="https://www.oracle.com/java/technologies/javase/8u131-relnotes.html" target="_blank" rel="noopener">8u131</a> 版本开始支持 UseCGroupMemoryLimitForHeap 和 MaxRAMFraction 这两个选项，用 CGroup 中限制的内存资源来作为分配的依据。选项默认是不开启的，需要开启 UnlockExperimentalVMOptions 才能使用。</p>
<p>下面通过 Docker 对容器内的 JVM 限制 100MB 的内存，对比是否开启选项的效果。</p>
<h3 id="未开启UseCGroupMemoryLimitForHeap"><a href="#未开启UseCGroupMemoryLimitForHeap" class="headerlink" title="未开启UseCGroupMemoryLimitForHeap"></a>未开启UseCGroupMemoryLimitForHeap</h3><p>可以看到 JVM 并未感知到 Docker(Cgroup) 对内存的限制，仍然为JVM Max. Heap Size 分配 (443.00MB) 超过资源限制。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  ~ docker run -m 100MB openjdk:8u131-alpine java -XshowSettings:vm -version</span><br><span class="line">VM settings:</span><br><span class="line">    Max. Heap Size (Estimated): 443.00M</span><br><span class="line">    Ergonomics Machine Class: server</span><br><span class="line">    Using VM: OpenJDK 64-Bit Server VM</span><br><span class="line"></span><br><span class="line">openjdk version "1.8.0_131"</span><br><span class="line">OpenJDK Runtime Environment (IcedTea 3.4.0) (Alpine 8.131.11-r2)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.131-b11, mixed mode)</span><br></pre></td></tr></table></figure>
<h3 id="开启UseCGroupMemoryLimitForHeap"><a href="#开启UseCGroupMemoryLimitForHeap" class="headerlink" title="开启UseCGroupMemoryLimitForHeap"></a>开启UseCGroupMemoryLimitForHeap</h3><p>JVM感知到 Docker(Cgroup) 对内存的限制，根据比例分配JVM Max. Heap Size 为 44.50MB。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  ~ docker run -m 100MB openjdk:8u131-alpine java -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XshowSettings:vm -version</span><br><span class="line">VM settings:</span><br><span class="line">    Max. Heap Size (Estimated): 44.50M</span><br><span class="line">    Ergonomics Machine Class: server</span><br><span class="line">    Using VM: OpenJDK 64-Bit Server VM</span><br><span class="line"></span><br><span class="line">openjdk version "1.8.0_131"</span><br><span class="line">OpenJDK Runtime Environment (IcedTea 3.4.0) (Alpine 8.131.11-r2)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.131-b11, mixed mode)</span><br></pre></td></tr></table></figure>
<h2 id="8u191版本"><a href="#8u191版本" class="headerlink" title="8u191版本"></a>8u191版本</h2><p>从 <a href="https://www.oracle.com/java/technologies/javase/8u191-relnotes.html" target="_blank" rel="noopener">8u191</a> 版本开始引入了 UseContainerSupport 选项，而且是默认启用的。该功能不仅能像 UseCGroupMemoryLimitForHeap 感知内存的资源限制，还能感知 CPU 的限制。</p>
<h3 id="关闭UseContainerSupport"><a href="#关闭UseContainerSupport" class="headerlink" title="关闭UseContainerSupport"></a>关闭UseContainerSupport</h3><p>可以看到 JVM 并未感知到 Docker(Cgroup) 对内存的限制，仍然为JVM Max. Heap Size 分配 (443.00MB) 超过资源限制。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  ~ docker run -m 100MB openjdk:8u191-alpine java -XX:-UseContainerSupport  -XshowSettings:vm -version</span><br><span class="line">VM settings:</span><br><span class="line">    Max. Heap Size (Estimated): 443.00M</span><br><span class="line">    Ergonomics Machine Class: server</span><br><span class="line">    Using VM: OpenJDK 64-Bit Server VM</span><br><span class="line"></span><br><span class="line">openjdk version "1.8.0_191"</span><br><span class="line">OpenJDK Runtime Environment (IcedTea 3.10.0) (Alpine 8.191.12-r0)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.191-b12, mixed mode)</span><br></pre></td></tr></table></figure>
<h3 id="开启UseContainerSupport-默认"><a href="#开启UseContainerSupport-默认" class="headerlink" title="开启UseContainerSupport (默认)"></a>开启UseContainerSupport (默认)</h3><p>JVM 默认能感知到 Docker(Cgroup) 对内存的限制，根据比例分配JVM Max. Heap Size 为 48.38MB。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  ~ docker run -m 100MB openjdk:8u191-alpine java -XshowSettings:vm -version</span><br><span class="line">VM settings:</span><br><span class="line">    Max. Heap Size (Estimated): 48.38M</span><br><span class="line">    Ergonomics Machine Class: server</span><br><span class="line">    Using VM: OpenJDK 64-Bit Server VM</span><br><span class="line"></span><br><span class="line">openjdk version "1.8.0_191"</span><br><span class="line">OpenJDK Runtime Environment (IcedTea 3.10.0) (Alpine 8.191.12-r0)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.191-b12, mixed mode)</span><br></pre></td></tr></table></figure>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ol>
<li>对于 8u191 及以上的版本，JVM已经能够比较好的感知 Docker 通过 CGroup 对容器的资源限制。</li>
<li>对于 8u131 至 8u191 的版本，需要显式的开启 UseCGroupMemoryLimitForHeap 选项，来让 JVM 感知 Docker 对容器的资源限制。</li>
<li>对于 8u131 以下的版本，需要用户根据Docker对资源的限制手动配置JVM参数，以防止出现非预期的OOM问题。</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ceshihao.github.io/2020/11/18/python-hash-inconsistency/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Dayu">
      <meta itemprop="description" content="ceshihao's blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ceshihao">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/11/18/python-hash-inconsistency/" itemprop="url">
                  Python的hash函数每次执行结果不一样的问题
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-11-18 14:41:50" itemprop="dateCreated datePublished" datetime="2020-11-18T14:41:50Z">2020-11-18</time>
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/11/18/python-hash-inconsistency/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2020/11/18/python-hash-inconsistency/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>近期遇到一个问题Python的 hash() 函数每次得到的哈希值不一样。例如</p>
<img src="/2020/11/18/python-hash-inconsistency/hash-inconsistency.png" class="" title="Hash Inconsistency">
<p>这会造成应用内部的一个根据 uid 哈希值取模的地方有问题，每次得到的结果不一样。为此我稍微深入的研究了一下这个 hash() 函数。</p>
<h2 id="调查过程"><a href="#调查过程" class="headerlink" title="调查过程"></a>调查过程</h2><p>首先查看了一下Python官方文档。hash() 函数的文档并没有提到为什么每次结果不一样。</p>
<p><a href="https://docs.python.org/3.6/library/functions.html#hash" target="_blank" rel="noopener">https://docs.python.org/3.6/library/functions.html#hash</a></p>
<img src="/2020/11/18/python-hash-inconsistency/python-doc-hash.png" class="" title="Python Doc hash">
<p>继续看一下内部实现的 <strong>hash</strong>() 函数。其中有一段提到 <strong>hash</strong>() 函数在处理 str，bytes 和datetime类型的对象时，会对其加盐，这个值会是一个不可预测的随机值 (an unpredictable random value)。这个值在同一个进程中是一致的，但在不同的进程之间是随机的。并且这个值可以通过 PYTHONHASHSEED 变量来设定。这个实现是从 Python 3.2.3 开始引入的。</p>
<p><a href="https://docs.python.org/3.6/reference/datamodel.html#object.__hash_" target="_blank" rel="noopener">https://docs.python.org/3.6/reference/datamodel.html#object.__hash_</a>_</p>
<img src="/2020/11/18/python-hash-inconsistency/python-doc-_hash_.png" class="" title="Python Doc _hash_">
<h2 id="验证实验"><a href="#验证实验" class="headerlink" title="验证实验"></a>验证实验</h2><p>根据上述的调查结果我们来进行实验验证一下。</p>
<h3 id="同一进程下的hash"><a href="#同一进程下的hash" class="headerlink" title="同一进程下的hash"></a>同一进程下的hash</h3><p>在同一个Python进程下，对同一个字符串 “123” 每次得到的哈希值是一样的。</p>
<img src="/2020/11/18/python-hash-inconsistency/hash_same_process.png" class="" title="Hash Same Process">
<h3 id="不同进程下的hash"><a href="#不同进程下的hash" class="headerlink" title="不同进程下的hash"></a>不同进程下的hash</h3><p>和开篇描述的问题类似，不同的进程下对同一个字符串 “123” 每次得到的哈希值是不一样的。</p>
<img src="/2020/11/18/python-hash-inconsistency/hash_different_process.png" class="" title="Hash Different Process">
<h3 id="设定PYTHONHASHSEED后，不同进程下的hash"><a href="#设定PYTHONHASHSEED后，不同进程下的hash" class="headerlink" title="设定PYTHONHASHSEED后，不同进程下的hash"></a>设定PYTHONHASHSEED后，不同进程下的hash</h3><p>设定 PYTHONHASHSEED 为一个固定值1后，不同的进程下对同一个字符串 “123” 每次得到的哈希值是一样的。</p>
<img src="/2020/11/18/python-hash-inconsistency/hash_same_seed.png" class="" title="Hash Same PYTHONHASHSEED">
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>既然Python的 hash() 函数无法保证不同进程间每次计算的哈希值一致，那我们如果想在不同的进程间得到一致的哈希结果要如何做呢？</p>
<p>答案是用 hashlib。hashlib 的哈希结果可以做到可重现可跨进程的一致性。</p>
<p><a href="https://docs.python.org/3.6/library/hashlib.html" target="_blank" rel="noopener">https://docs.python.org/3.6/library/hashlib.html</a></p>
<p>针对上面不同进程下的情况，我们用 hashlib 重复做一次实验。从结果我们可以看到，不同进程中每次的哈希结果是一致的 (只不过返回的类型不像 hash() 函数是int)。</p>
<img src="/2020/11/18/python-hash-inconsistency/python-hashlib.png" class="" title="Python hashlib">
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>在同一个进程内做简单的哈希比较是可以使用 hash() 函数的，而且哈希的结果是一致的。</li>
<li>在不同进程间如果哈希结果只用与散列，而不是结果比较时 hash() 函数也是可以使用的。</li>
<li>如果用于不同进程间的哈希值比较，不应该使用 hash() 函数，而应该使用hashlib。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ceshihao.github.io/2018/11/29/tracing-db-operations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Dayu">
      <meta itemprop="description" content="ceshihao's blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ceshihao">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/29/tracing-db-operations/" itemprop="url">
                  Trace MySQL DB Operations in Opentracing System
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-11-28 22:17:00" itemprop="dateCreated datePublished" datetime="2018-11-28T22:17:00Z">2018-11-28</time>
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/11/29/tracing-db-operations/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/11/29/tracing-db-operations/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><ul>
<li>go &gt;= 1.8</li>
<li>mysql driver &gt;= 1.4.0 (with Context support)</li>
<li>OpenTracing System (e.g. Zipkin/Jaeger)</li>
</ul>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h3 id="Code-Examples"><a href="#Code-Examples" class="headerlink" title="Code Examples"></a>Code Examples</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">    <span class="string">"github.com/luna-duclos/instrumentedsql"</span></span><br><span class="line">    <span class="string">"github.com/luna-duclos/instrumentedsql/opentracing"</span></span><br><span class="line">    ...</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">    sql.Register(<span class="string">"instrumented-mysql"</span>,</span><br><span class="line">        instrumentedsql.WrapDriver(mysql.MySQLDriver&#123;&#125;,</span><br><span class="line">            instrumentedsql.WithTracer(opentracing.NewTracer(<span class="literal">false</span>)),</span><br><span class="line">            instrumentedsql.WithOmitArgs(),</span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line">    db, err := sql.Open(<span class="string">"instrumented-mysql"</span>, dsn)</span><br><span class="line">    <span class="comment">// db, err := sql.Open("mysql", dsn)</span></span><br></pre></td></tr></table></figure>
<h3 id="Jaeger-Example"><a href="#Jaeger-Example" class="headerlink" title="Jaeger Example"></a>Jaeger Example</h3><img src="/2018/11/29/tracing-db-operations/opentracing-db.png" class="" title="Jaeger Example">
<h2 id="Performance-Benchmark"><a href="#Performance-Benchmark" class="headerlink" title="Performance Benchmark"></a>Performance Benchmark</h2><p>Wrapped MySQL driver does not have obvious performance impact.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: demo/dbtracing</span><br><span class="line"></span><br><span class="line">BenchmarkDriverSelect1<span class="number">-8</span>             <span class="number">1000000</span>          <span class="number">1098</span> ns/op</span><br><span class="line">BenchmarkWrappedDriverSelect1<span class="number">-8</span>      <span class="number">1000000</span>          <span class="number">1108</span> ns/op</span><br><span class="line">BenchmarkDriverPing<span class="number">-8</span>                <span class="number">1000000</span>          <span class="number">1091</span> ns/op</span><br><span class="line">BenchmarkWrappedDriverPing<span class="number">-8</span>         <span class="number">1000000</span>          <span class="number">1097</span> ns/op</span><br><span class="line"></span><br><span class="line">PASS</span><br><span class="line">ok      demo/dbtracing  <span class="number">4.485</span>s</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://github.com/golang/go/issues/18080" target="_blank" rel="noopener">github.com/golang/go/issues/18080</a></li>
<li><a href="https://github.com/go-sql-driver/mysql/pull/445" target="_blank" rel="noopener">github.com/go-sql-driver/mysql/pull/445</a></li>
<li><a href="https://github.com/luna-duclos/instrumentedsql" target="_blank" rel="noopener">github.com/luna-duclos/instrumentedsql</a></li>
<li><a href="https://opencensus.io/" target="_blank" rel="noopener">opencensus.io</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ceshihao.github.io/2018/04/20/my-first-golang-contribution/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Dayu">
      <meta itemprop="description" content="ceshihao's blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ceshihao">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/20/my-first-golang-contribution/" itemprop="url">
                  记一次 Golang Contribution
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-19 18:15:13" itemprop="dateCreated datePublished" datetime="2018-04-19T18:15:13Z">2018-04-19</time>
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/20/my-first-golang-contribution/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/20/my-first-golang-contribution/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>源于这个 issue <a href="https://github.com/golang/go/issues/24767" target="_blank" rel="noopener">#24767</a>。正好我最近也在用 <code>text/template</code> 这个包来做一些工具（其实主要因为我太弱，这个改动简单……），所以产生了兴趣。</p>
<p>改动很简单，就是有一个 example 和它的描述不相符，补一个符合的 example。但是在代码的提交上花了一些时间。</p>
<p>早就听说 golang 的代码托管在自己的 <a href="https://go.googlesource.com/go" target="_blank" rel="noopener">Gerrit</a> 上，而且提交的流程和一般在 github 上的项目会有些不同。这次终于能自己亲身实践一次。绝大部分步骤都是按照 <a href="https://golang.org/doc/contribute.html" target="_blank" rel="noopener">Contribute</a>上说的来。</p>
<h2 id="准备-Contributor-的前期工作"><a href="#准备-Contributor-的前期工作" class="headerlink" title="准备 Contributor 的前期工作"></a>准备 Contributor 的前期工作</h2><p>安装 go-contrib-init 工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$go</span> get -u golang.org/x/tools/cmd/go-contrib-init</span><br><span class="line"><span class="variable">$cd</span> /code/to/edit</span><br><span class="line"><span class="variable">$go</span>-contrib-init</span><br></pre></td></tr></table></figure>
<p>配置 Gerrit</p>
<ul>
<li>登录 googlesource 并生成 password ，这时在页面上会生成一个脚本。</li>
<li>在 shell 里跑这个脚本。</li>
<li>在 <a href="https://go-review.googlesource.com" target="_blank" rel="noopener">Gerrit Review</a> 网站上注册自己的账号。</li>
</ul>
<p>同意 CLA 协议，自己看吧。</p>
<h2 id="准备开发环境"><a href="#准备开发环境" class="headerlink" title="准备开发环境"></a>准备开发环境</h2><p>安装 git-codereview</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">go get -u golang.org/x/review/git-codereview</span></span><br></pre></td></tr></table></figure>
<p>配置指令 alias (这一步建议还是配置一下。一开始我没有配，就会导致文档上的指令还要自己脑力转换一下才能跑……)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">alias</span>]</span><br><span class="line">    change = codereview change</span><br><span class="line">    gofmt = codereview gofmt</span><br><span class="line">    mail = codereview mail</span><br><span class="line">    pending = codereview pending</span><br><span class="line">    submit = codereview submit</span><br><span class="line">    sync = codereview sync</span><br></pre></td></tr></table></figure>
<h2 id="正式开始修改代码"><a href="#正式开始修改代码" class="headerlink" title="正式开始修改代码"></a>正式开始修改代码</h2><p>这部分还可以参考 git-codereview 的<a href="https://godoc.org/golang.org/x/review/git-codereview" target="_blank" rel="noopener">文档</a>。</p>
<p>下载go的源代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">git <span class="built_in">clone</span> https://go.googlesource.com/go</span></span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="built_in">cd</span> go</span></span><br></pre></td></tr></table></figure>
<p>同步go的主干分支</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">git checkout master</span></span><br><span class="line"><span class="meta">$</span><span class="bash">git sync</span></span><br></pre></td></tr></table></figure>
<p>终于可以肆意进行你的改动了</p>
<ul>
<li>提交你的代码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">git add/rm/mv &lt;files&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">git change &lt;branch&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">git commit</span></span><br></pre></td></tr></table></figure>
<p>这时会默认 <code>$EDITOR</code> 指定的编辑器(默认 <code>vi</code>)来输入你的 commit message。</p>
<h2 id="发送需要review的代码"><a href="#发送需要review的代码" class="headerlink" title="发送需要review的代码"></a>发送需要review的代码</h2><p>一条简单的指令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">git mail</span></span><br></pre></td></tr></table></figure>
<p>当然也可以稍微复杂一点，指定 reviewer 和 cc</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">git mail -r joe@golang.org -cc mabel@example.com,math-nuts@swtch.com</span></span><br></pre></td></tr></table></figure>
<p>到这里基本上就大功告成了，等待自己的CL被大牛们review吧。</p>
<h2 id="代码审查"><a href="#代码审查" class="headerlink" title="代码审查"></a>代码审查</h2><p>由于这个issue Rob Pike之前有过comment，并且之前不一致的example就是他写的。所以他转天很快就在<a href="https://go-review.googlesource.com/c/go/+/107663" target="_blank" rel="noopener">CL</a>上给了comments。</p>
<p>这时，我可有点犯了难。Gerrit 不像 github 上直接在分支上追加 commit 就行了,而是要在 CL 上提交新的 patch set。又马上 google 各种搜索了一通。<br>用<code>git commit --amend</code>解决了问题。重新提交也很快被Rob Pike merge了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>虽然这个 contribution 没啥技术含量，但是也算体验了一把 golang contribution 的流程，应该会包含在 go1.11 的 release 中。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ceshihao.github.io/2018/01/11/prepare-statement-in-go-mysql-driver/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Dayu">
      <meta itemprop="description" content="ceshihao's blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ceshihao">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/11/prepare-statement-in-go-mysql-driver/" itemprop="url">
                  Prepare Statements in Golang MySQL Driver
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-10 16:27:09" itemprop="dateCreated datePublished" datetime="2018-01-10T16:27:09Z">2018-01-10</time>
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/11/prepare-statement-in-go-mysql-driver/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/11/prepare-statement-in-go-mysql-driver/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://github.com/go-sql-driver/mysql" target="_blank" rel="noopener"><code>go-sql-driver/mysql</code></a> has two kinds of functions <code>Query()</code> and <code>Exec()</code>.<br>I would like to see how <code>Query()</code> works.</p>
<h2 id="Two-Modes"><a href="#Two-Modes" class="headerlink" title="Two Modes"></a>Two Modes</h2><p><code>Query(query string, args ...interface{})</code> function has two modes according to whether there are <code>args</code>.</p>
<h3 id="Plaintext-Mode"><a href="#Plaintext-Mode" class="headerlink" title="Plaintext Mode"></a>Plaintext Mode</h3><p>If <code>Query(query)</code> is called without <code>args</code>, I call it ‘Plantext Mode’.</p>
<p>In this mode, driver does NOT do anything on the query string, and just send it directly to MySQL server.</p>
<h3 id="Interpolation-Mode"><a href="#Interpolation-Mode" class="headerlink" title="Interpolation Mode"></a>Interpolation Mode</h3><p>If there are some placeholders in query string (i.e. <code>?</code> in MySQL) and some <code>args</code> are passed in to interpolate, I call it ‘Interpolation Mode’.</p>
<p>In this mode, driver actually does 3 actions</p>
<ul>
<li><p>Prepare a statement.</p>
</li>
<li><p>Execute the prepared statement using given <code>args</code>.</p>
</li>
<li><p>Close the prepared statement.</p>
</li>
</ul>
<p>That is exactly the slogan of prepared statement <code>Prepare Once, Execute Many</code>.</p>
<h2 id="Difference"><a href="#Difference" class="headerlink" title="Difference"></a>Difference</h2><h3 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h3><p>Assume you have a table named <code>prepare</code></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>name1</td>
</tr>
<tr>
<td>2</td>
<td>name2</td>
</tr>
<tr>
<td>3</td>
<td>name3</td>
</tr>
</tbody>
</table>
<p>A SQL can be run <code>select id, name from prepare where id = 1;</code> on this table.</p>
<p>It returns</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>name1</td>
</tr>
</tbody>
</table>
<p>Everything is fine. Ok, let’s have a look at how to implement it in previous two modes.</p>
<ul>
<li>Plaintext Mode</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">plaintextQuery</span><span class="params">(db *sql.DB, id <span class="keyword">string</span>)</span> *<span class="title">sql</span>.<span class="title">Row</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> db.Query(<span class="string">"select id, name from prepare where id = "</span> + id + <span class="string">";"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Interpolation Mode</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">interpolationQuery</span><span class="params">(db *sql.DB, id <span class="keyword">string</span>)</span> *<span class="title">sql</span>.<span class="title">Row</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> db.Query(<span class="string">"select id, name from prepare where id = ?;"</span>, id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When you pass “1” as id, everything is expected. However, is it really OK? Let’s try a SQL injection case, pass “1 or 1 = 1” as id.</p>
<p>Oops, <code>interpolationQuery()</code> still returns the same, but <code>plaintextQuery()</code> returns all data in the table which means violated SQL has been injected.</p>
<h3 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h3><p>I make up a simple insert SQL through the two modes.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Inserts Number:  100000</span><br><span class="line">Plaintext Mode</span><br><span class="line">Duration 16.058662357s</span><br><span class="line">Interpolation Mode</span><br><span class="line">Duration 24.076297264s</span><br></pre></td></tr></table></figure>
<p>It means that <code>Plaintext Mode</code> has a better performance than <code>Interpolation Mode</code>.<br>It is reasonable because <code>Interpolation Mode</code> has to do 3 network communications per <code>Query()</code> or <code>Exec()</code>.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><ul>
<li><p><code>Interpolation Mode</code> can be used to avoid most of SQL injection, which is an important benifit. Therefore, it is highly recommended to use it especially for user input parameters may cause SQL injection.</p>
</li>
<li><p><code>Plaintext Mode</code> has a better performance to some extent. However, there still some methods to speed up <code>Interpolation Mode</code>, I will talk about it later.</p>
</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://go-database-sql.org/prepared.html" target="_blank" rel="noopener">Using Prepared Statements</a></li>
<li><a href="https://www.jianshu.com/p/ee0d2e7bef54" target="_blank" rel="noopener">Golang Mysql笔记（三）— Prepared剖析</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ceshihao.github.io/2017/09/06/my-first-blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Dayu">
      <meta itemprop="description" content="ceshihao's blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ceshihao">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/06/my-first-blog/" itemprop="url">
                  My First Blog
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-09-06 15:01:19" itemprop="dateCreated datePublished" datetime="2017-09-06T15:01:19Z">2017-09-06</time>
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/06/my-first-blog/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/06/my-first-blog/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hello everyone!</p>
<p>This is my first blog in this site.<br>I am trying to post my blog using <a href="https://hexo.io" target="_blank" rel="noopener">hexo</a>, which is amazing.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Zheng Dayu</p>
              <p class="site-description motion-element" itemprop="description">ceshihao's blog</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/%20%7C%7C%20archive">
                
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/ceshihao" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.linkedin.com/in/dayu-zheng-8b86613a/" target="_blank" title="Linkedin" rel="external nofollow"><i class="fa fa-fw fa-linkedin"></i>Linkedin</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:davidzheng23@gmail.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://stackoverflow.com/users/4209139/ceshihao" target="_blank" title="StackOverflow" rel="external nofollow"><i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright"> &copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zheng Dayu</span>

  

  
</div>


  



  <div class="powered-by">Powered by <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> v4.2.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a class="theme-link" target="_blank" rel="external nofollow" href="https://theme-next.org">NexT.Muse</a> v6.5.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="Total Visitors">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="Total Views">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  

  
    <script id="dsq-count-scr" src="https://ceshihao.disqus.com/count.js" async></script>
  

  












  





  

  

  

  

  

  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  

  

  

</body>
</html>
